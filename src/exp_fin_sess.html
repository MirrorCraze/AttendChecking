<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Previous Session</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style media="screen">
    .w3-sidebar a {font-family: "Roboto", sans-serif}
    body,h1,h2,h3,h4,h5,h6,.w3-wide {font-family: "Montserrat", sans-serif;}
    h1{color: white}

      thead{
        width: 100%;
      }
      th, td{
        border: 1px solid black;
        width: 1% !important;
      }
      .topsp{
        margin-top:0px;
      }
      .leftsp{
        margin-left: 250px;
      }
      @media only screen and (max-width: 994px) {
        .topsp{
          margin-top: 80px;
        }
        .leftsp{
          margin-left: 0px;
        }
      }
      div.shift{
        margin-left: 3%;
        margin-right: 3%
      }
      input.shift {
        margin-top: 10px;
      }
      th {
        background-color: rgba(15,15,15,0.6);
        color: white;
        font-style: italic;
      }
      td {
        background-color: rgba(255,255,255,0.4);
      }
      body {
        margin-left: 0%;
        margin-right: 0%;
        background-color: #d0d0d0;
     }
     h2 {
       background-image: url("http://www.syitc.com/wp-content/uploads/2012/01/shutterstock_469392011-e1327991187480-651x253.jpg");
       background-repeat: no-repeat;
       background-size: cover;
       opacity: 0.8;
       padding: 12px;
       font-style: italic;
       color: #ffffff;
       text-shadow: 1px 2px #ffa0a5;
     }
    </style>
  </head>

  <body onload = "fill_form()">    <!-- Top menu on small screens -->
      <header class="w3-bar w3-top w3-hide-large w3-black w3-xlarge">
        <div class="w3-bar-item w3-padding-24 w3-wide">Team's name</div>
        <a href="javascript:void(0)" class="w3-bar-item w3-button w3-padding-24 w3-right" onclick="w3_open()"><i class="fa fa-bars"></i></a>
      </header>
      <!-- Sidebar/menu -->
      <nav class="w3-sidebar w3-bar-block w3-white w3-collapse w3-top" style="z-index:3;width:250px" id="mySidebar">
        <div class="w3-container w3-display-container w3-padding-16">
          <i onclick="w3_close()" class="fa fa-remove w3-hide-large w3-button w3-display-topright"></i>
          <h3 class="w3-wide"><b>Team's Name</b></h3>
        </div>

        <div class="w3-padding-64 w3-large w3-text-grey" style="font-weight:bold">
          <a href="index.html" class="w3-bar-item w3-button w3-padding">MainPage</a>
          <a onclick="myAccFunc('NewTask')" href="javascript:void(0)" class="w3-button w3-block w3-white w3-left-align" id="myBtn">
            Create new task <i class="fa fa-caret-down"></i>
          </a>
          <div id="NewTask" class="w3-bar-block w3-hide w3-padding-large w3-medium">
            <a href="set_class.html" class="w3-bar-item w3-button">Classroom</a>
            <a href="set_exam.html" class="w3-bar-item w3-button">Examination</a>
          </div>
          <a onclick="myAccFunc('TaskHistory')" href="javascript:void(0)" class="w3-button w3-block w3-white w3-left-align" id="myBtn">
            Task History <i class="fa fa-caret-down"></i>
          </a>
          <div id="TaskHistory" class="w3-bar-block w3-hide w3-padding-large w3-medium">
            <a href="prev_sess.html" class="w3-bar-item w3-button">Pending task</a>
            <a href="exp_fin_sess.html" class="w3-bar-item w3-button">Export finished task</a>
          </div>
        <a href="#footer" class="w3-bar-item w3-button w3-padding">Contact</a>
        <a href="login.html" class="w3-bar-item w3-button w3-padding">Logout</a>
      </nav>
    <div class="queue leftsp">
      <h2 class="rounded-bottom topsp">
        Exporting Attendance
      </h2>
      <form action="index.html" method="post">
        <div class="shift">
        <table id="all_history">
          <thead>
            <th>Class No.</th>
            <th>Date</th>
            <th>Start</th>
            <th>Stop</th>
            <th>Late</th>
            <th>Type</th>
            <th>Export?</th>
          </thead>
        </table>
          <button onclick="exportTableToCSV('Student_file.csv')"> Export Data</button>
      </div>
      </form>

    </div>
    <script>
    // Accordion
    function myAccFunc(id) {
      var x = document.getElementById(id);
      if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
      } else {
        x.className = x.className.replace(" w3-show", "");
      }
    }

    // Click on the "Jeans" link on page load to open the accordion for demo purposes
    document.getElementById("myBtn").click()


    // Open and close sidebar
    function w3_open() {
      document.getElementById("mySidebar").style.display = "block";
      document.getElementById("myOverlay").style.display = "block";
    }

    function w3_close() {
      document.getElementById("mySidebar").style.display = "none";
      document.getElementById("myOverlay").style.display = "none";
    }
    function fill_form()
    {
      console.log(Object.keys(localStorage));
      key = Object.keys(localStorage);
      //alert(key);
      var history = document.querySelector('#all_history');

      for (var subject in key){

        //alert("SJ" + subject)
        var sub = JSON.parse(localStorage.getItem(key[subject]));
        console.log(sub);
        subkey = Object.keys(sub);
        //alert("SUB " + subkey);
        console.log(sub[subkey]);
        var row_amount_history = history.rows.length;
        var newrow = history.insertRow(row_amount_history);
        newrow.id = key[subject];
        var new_subject = newrow.insertCell(0);
        var new_date = newrow.insertCell(1);
        var new_start = newrow.insertCell(2);
        var new_stop = newrow.insertCell(3);
        var new_late = newrow.insertCell(4);
        var new_type = newrow.insertCell(5);
        new_subject.innerHTML = sub["class"];
        new_date.innerHTML = sub["date"];
        new_start.innerHTML = sub["time_start"];
        new_stop.innerHTML = sub["time_stop"];
        new_late.innerHTML = sub["time_late"];
        new_type.innerHTML = sub["type"];

      }
    }
    function ClearData()
    {
      var check = confirm("Delete all previous data?");
      if(check)
      {
        localStorage.clear();
        document.getElementById("myTable").deleteRow(0);
        return true;
      }
      else return false;
    }

    function downloadCSV(csv, filename) {
    var csvFile;
    var downloadLink;

    // CSV file
    csvFile = new Blob([csv], {type: "text/csv"});

    // Download link
    downloadLink = document.createElement("a");

    // File name
    downloadLink.download = filename;

    // Create a link to the file
    downloadLink.href = window.URL.createObjectURL(csvFile);

    // Hide download link
    downloadLink.style.display = "none";

    // Add the link to DOM
    document.body.appendChild(downloadLink);

    // Click download link
    downloadLink.click();
    }
    function exportTableToCSV(filename) {
    var csv = [];
    var rows = document.querySelectorAll("table tr");

    for (var i = 0; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll("td, th");

        for (var j = 0; j < cols.length; j++)
            row.push(cols[j].innerText);

        csv.push(row.join(","));
    }

    // Download CSV file
    downloadCSV(csv.join("\n"), filename);
    }
    </script>
  </body>
</html>
